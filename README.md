# IVS Sessions Browser v3

A terminal-based TUI for browsing [IVS session schedules](https://ivscc.gsfc.nasa.gov/sessions/): master and intensives, with fast filtering, keyboard navigation, and colorized status.

- **TUI**: curses interface with smooth navigation
- **Filters**: powerful, composable query language
- **Colors**: quick status scanning (Released / Processing / Waiting / Cancelled / None)
- **Open in browser**: jump to the IVS page for a session
- **Toggle removed stations**: see active, removed or both
- **Jump to today**: one-key shortcut to the current session row

See also:
- üìÑ [`docs/USER_GUIDE.md`](docs/USER_GUIDE.md)
- üîé [`docs/FILTER_SYNTAX.md`](docs/FILTER_SYNTAX.md)
- ‚å®Ô∏è [`docs/KEY_BINDINGS.md`](docs/KEY_BINDINGS.md)
- üó∫Ô∏è [`docs/ROADMAP.md`](docs/ROADMAP.md)

---

## Project layout

```
ivs_sessions_browser/
‚îú‚îÄ docs/
‚îÇ  ‚îú‚îÄ FILTER_SYNTAX.md
‚îÇ  ‚îú‚îÄ KEY_BINDINGS.md
‚îÇ  ‚îú‚îÄ ROADMAP.md
‚îÇ  ‚îî‚îÄ USER_GUIDE.md
‚îú‚îÄ scripts/
‚îÇ  ‚îî‚îÄ run_sessions_browser.py        # launcher (imports package main)
‚îú‚îÄ src/
‚îÇ  ‚îî‚îÄ ivs_sessions_browser/
‚îÇ     ‚îú‚îÄ __init__.py                 # exposes main(), __version__
‚îÇ     ‚îú‚îÄ __main__.py                 # allows `python -m ivs_sessions_browser`
‚îÇ     ‚îú‚îÄ ivs_sessions_browser.py     # TUI app (browser)
‚îÇ     ‚îú‚îÄ get_data_from_url.py        # network fetch helper(s)
‚îÇ     ‚îî‚îÄ _version.py                 # autogenerated by setuptools-scm
‚îú‚îÄ pyproject.toml
‚îú‚îÄ requirements.txt
‚îú‚îÄ LICENSE
‚îî‚îÄ README.md
```

> **Note:** The project uses the **src/** layout. When running from the terminal, add `src/` to `PYTHONPATH` (details below).
> Inside PyCharm, mark `src/` as **Sources Root**.

---

## Requirements

- Python **3.10+**
- Linux/macOS terminal with curses support
  Windows users: `pip install windows-curses`
- Internet access to fetch schedules from ivscc.gsfc.nasa.gov

---

## Installation

```bash
git clone https://github.com/faksdal/ivs_sessions_browser.git
cd ivs_sessions_browser

python3 -m venv .venv
source .venv/bin/activate            # Windows PowerShell: .\.venv\Scripts\Activate.ps1

pip install -r requirements.txt
```

### Optional (editable dev install)

If you want a console command in your venv and editable sources:

1) Ensure `pyproject.toml` includes:
```toml
[project]
# ...
# dynamic = ["version"]  # if using setuptools-scm
# ...

[project.scripts]
ivs-sessions-browser = "ivs_sessions_browser:main"
```

2) Then:
```bash
pip install -e .
```

You can now run:
```bash
ivs-sessions-browser
```

---

## How to run (terminal)

You have multiple equivalent ways. Pick your favorite:

### A) Wrapper script (recommended for simplicity)
Create `run_browser` in the **project root**:

```bash
#!/usr/bin/env bash
set -euo pipefail
SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
PROJECT_ROOT="$SCRIPT_DIR"
VENV_PY="$PROJECT_ROOT/.venv/bin/python3"
[ -x "$VENV_PY" ] || { echo "Missing venv at $VENV_PY"; exit 1; }
export PYTHONPATH="$PROJECT_ROOT/src"
exec "$VENV_PY" "$PROJECT_ROOT/scripts/run_sessions_browser.py" "$@"
```

Then:
```bash
chmod +x ./run_browser
./run_browser
```

### B) Direct script with `PYTHONPATH`
From project root:
```bash
PYTHONPATH=src python3 scripts/run_sessions_browser.py
```
Windows (PowerShell):
```powershell
$env:PYTHONPATH="src"; python .\scripts
un_sessions_browser.py
```

### C) Run the package as a module
Because `src/ivs_sessions_browser/__main__.py` is present:
```bash
PYTHONPATH=src python3 -m ivs_sessions_browser
```

### D) Console script (after editable install)
```bash
ivs-sessions-browser
```

---

## Running in PyCharm

1. **Open the project** (File ‚Üí Open ‚Üí project folder).
2. **Interpreter**: File ‚Üí Settings ‚Üí Project ‚Üí Python Interpreter ‚Üí select `.venv/bin/python`.
3. **Mark Source Root**: right-click `src/` ‚Üí *Mark Directory As* ‚Üí **Sources Root** (turns blue).
4. **Run/Debug Configuration**:
   - Add **Python** configuration
   - **Script path**: `scripts/run_sessions_browser.py`
     *(or select ‚ÄúModule name‚Äù ‚Üí `ivs_sessions_browser`)*
   - **Working directory**: project root
   - **Interpreter**: the project `.venv`
   - **Environment variables**: add `PYTHONPATH=$PROJECT_DIR$/src`

Click ‚ñ∂Ô∏è to run, üêû to debug.

---

## Usage

Most usage is interactive (TUI). Command-line flags typically include (subject to change as v3 evolves):

```
--year 2025            # which IVS year to fetch
--scope master|intensive|both
--stations "Ns|Nn"     # prefilter stations
--sessions "code:R1"   # prefilter non-station fields
```

Run with `-h` (help) to see current options if exposed by `main()`.

Once inside the TUI:
- Use arrow keys / PgUp / PgDn / Home / End to navigate
- Press `T` to jump to today
- Press `/` to enter a filter
- Press `F` to clear filters
- Press `R` to show/hide removed stations
- Press `Enter` to open the selected session in your browser
- Press `?` for inline help
- Press `q` to quit

Full details:
- üîé Filtering: [`docs/FILTER_SYNTAX.md`](docs/FILTER_SYNTAX.md)
- ‚å®Ô∏è Keys: [`docs/KEY_BINDINGS.md`](docs/KEY_BINDINGS.md)

---

## Filter basics (quick primer)

- Clauses separated by `;` are **AND**.
- **Stations** fields are **case-sensitive**.
- Other fields are **case-insensitive**.
- Within a non-station field, tokens split by space/comma/`+`/`|` are **OR**.

Examples:
- `code:R1|R4` ‚Üí codes matching R1 **or** R4
- `stations:Nn&Ns` ‚Üí requires **both** Nn **and** Ns present
- `stations_removed:Ft|Ur` ‚Üí removed stations include Ft **or** Ur
- `stations_all:Hb|Ht` ‚Üí either Hb or Ht present (active or removed)

More: [`docs/FILTER_SYNTAX.md`](docs/FILTER_SYNTAX.md)

---

## Troubleshooting

**`ModuleNotFoundError: No module named 'ivs_sessions_browser'`**
You‚Äôre running from the terminal without telling Python about `src/`. Use one of:
- `PYTHONPATH=src python3 scripts/run_sessions_browser.py`
- `./run_browser` wrapper
- In PyCharm, add `PYTHONPATH=$PROJECT_DIR$/src` to the Run configuration

**Windows: curses import error**
Install: `pip install windows-curses`. Run in a terminal that supports ANSI.

**No colors / weird characters**
Use a modern terminal with UTF-8 and 256-color support; ensure `$TERM` is e.g. `xterm-256color`.

---

## Versioning

This project uses **setuptools-scm**. Version strings are derived from Git tags (`v3.0`, `v3.1`, ‚Ä¶). The file `src/ivs_sessions_browser/_version.py` is autogenerated.
To cut a release:
```bash
git tag v3.0
git push --tags
```

---

## Contributing

- Keep the TUI responsive; avoid blocking network calls on the UI thread.
- Prefer small, focused modules under `src/ivs_sessions_browser/`.
- Write clear commit messages; tag releases for versioning.

---

## License

MIT ‚Äî see [LICENSE](LICENSE).

---

## Acknowledgments

- IVS Central Bureau & Goddard Space Flight Center for session listings
- Contributors and testers across Ny-√Ölesund & Brandal observatories
